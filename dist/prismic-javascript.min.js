!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.PrismicJS={})}(this,function(t){"use strict";class e{constructor(t){this.data={},this.data=t}id(){return this.data.id}ref(){return this.data.ref}label(){return this.data.label}}class r{constructor(t){this.data={},this.data=t,this.variations=(t.variations||[]).map(t=>new e(t))}id(){return this.data.id}googleId(){return this.data.googleId}name(){return this.data.name}}class n{constructor(t){t&&(this.drafts=(t.drafts||[]).map(t=>new r(t)),this.running=(t.running||[]).map(t=>new r(t)))}current(){return this.running.length>0?this.running[0]:null}refFromCookie(t){if(!t||""===t.trim())return null;const e=t.trim().split(" ");if(e.length<2)return null;const r=e[0],n=parseInt(e[1],10),i=this.running.filter(t=>t.googleId()===r&&t.variations.length>n)[0];return i?i.variations[n].ref():null}}class i{constructor(t,e){this.id=t,this.api=e,this.fields={}}set(t,e){return this.fields[t]=e,this}ref(t){return this.set("ref",t)}query(t){return this.set("q",t)}pageSize(t){return this.set("pageSize",t)}fetch(t){return this.set("fetch",t)}fetchLinks(t){return this.set("fetchLinks",t)}lang(t){return this.set("lang",t)}page(t){return this.set("page",t)}after(t){return this.set("after",t)}orderings(t){return this.set("orderings",t)}url(){return this.api.get().then(t=>i.toSearchForm(this,t).url())}submit(t){return this.api.get().then(e=>i.toSearchForm(this,e).submit(t))}static toSearchForm(t,e){const r=e.form(t.id);if(r)return Object.keys(t.fields).reduce((e,r)=>{const n=t.fields[r];return"q"===r?e.query(n):"pageSize"===r?e.pageSize(n):"fetch"===r?e.fetch(n):"fetchLinks"===r?e.fetchLinks(n):"lang"===r?e.lang(n):"page"===r?e.page(n):"after"===r?e.after(n):"orderings"===r?e.orderings(n):e.set(r,n)},r);throw new Error(`Unable to access to form ${t.id}`)}}class s{constructor(t,e){this.httpClient=e,this.form=t,this.data={};for(const e in t.fields)t.fields[e].default&&(this.data[e]=[t.fields[e].default])}set(t,e){const r=this.form.fields[t];if(!r)throw new Error("Unknown field "+t);const n=""===e||void 0===e?null:e;let i=this.data[t]||[];return i=r.multiple?n?i.concat([n]):i:n?[n]:i,this.data[t]=i,this}ref(t){return this.set("ref",t)}query(t){if("string"==typeof t)return this.query([t]);if(t instanceof Array)return this.set("q",`[${t.join("")}]`);throw new Error(`Invalid query : ${t}`)}pageSize(t){return this.set("pageSize",t)}fetch(t){const e=t instanceof Array?t.join(","):t;return this.set("fetch",e)}fetchLinks(t){const e=t instanceof Array?t.join(","):t;return this.set("fetchLinks",e)}lang(t){return this.set("lang",t)}page(t){return this.set("page",t)}after(t){return this.set("after",t)}orderings(t){return t?this.set("orderings",`[${t.join(",")}]`):this}url(){let t=this.form.action;if(this.data){let e=t.indexOf("?")>-1?"&":"?";for(const r in this.data)if(this.data.hasOwnProperty(r)){const n=this.data[r];if(n)for(let i=0;i<n.length;i++)t+=e+r+"="+encodeURIComponent(n[i]),e="&"}}return t}submit(t){return this.httpClient.cachedRequest(this.url()).then(e=>(t&&t(null,e),e)).catch(e=>{throw t&&t(e),e})}}const o="at",a="not",h="missing",u="has",l="any",f="in",c="fulltext",d="similar",p="number.gt",g="number.lt",y="number.inRange",m="date.before",$="date.after",w="date.between",k="date.day-of-month",v="date.day-of-month-after",b="date.day-of-month-before",A="date.day-of-week",q="date.day-of-week-after",x="date.day-of-week-before",B="date.month",I="date.month-before",O="date.month-after",S="date.year",R="date.hour",D="date.hour-before",C="date.hour-after",j="geopoint.near";function E(t){if("string"==typeof t)return`"${t}"`;if("number"==typeof t)return t.toString();if(t instanceof Date)return t.getTime().toString();if(t instanceof Array)return`[${t.map(t=>E(t)).join(",")}]`;throw new Error(`Unable to encode ${t} of type ${typeof t}`)}const _={near:(t,e,r,n)=>`[${j}(${t}, ${e}, ${r}, ${n})]`},z={before:(t,e)=>`[${m}(${t}, ${E(e)})]`,after:(t,e)=>`[${$}(${t}, ${E(e)})]`,between:(t,e,r)=>`[${w}(${t}, ${E(e)}, ${E(r)})]`,dayOfMonth:(t,e)=>`[${k}(${t}, ${e})]`,dayOfMonthAfter:(t,e)=>`[${v}(${t}, ${e})]`,dayOfMonthBefore:(t,e)=>`[${b}(${t}, ${e})]`,dayOfWeek:(t,e)=>`[${A}(${t}, ${E(e)})]`,dayOfWeekAfter:(t,e)=>`[${q}(${t}, ${E(e)})]`,dayOfWeekBefore:(t,e)=>`[${x}(${t}, ${E(e)})]`,month:(t,e)=>`[${B}(${t}, ${E(e)})]`,monthBefore:(t,e)=>`[${I}(${t}, ${E(e)})]`,monthAfter:(t,e)=>`[${O}(${t}, ${E(e)})]`,year:(t,e)=>`[${S}(${t}, ${e})]`,hour:(t,e)=>`[${R}(${t}, ${e})]`,hourBefore:(t,e)=>`[${D}(${t}, ${e})]`,hourAfter:(t,e)=>`[${C}(${t}, ${e})]`},F={gt:(t,e)=>`[${p}(${t}, ${e})]`,lt:(t,e)=>`[${g}(${t}, ${e})]`,inRange:(t,e,r)=>`[${y}(${t}, ${e}, ${r})]`};var M={at:(t,e)=>`[${o}(${t}, ${E(e)})]`,not:(t,e)=>`[${a}(${t}, ${E(e)})]`,missing:t=>`[${h}(${t})]`,has:t=>`[${u}(${t})]`,any:(t,e)=>`[${l}(${t}, ${E(e)})]`,in:(t,e)=>`[${f}(${t}, ${E(e)})]`,fulltext:(t,e)=>`[${c}(${t}, ${E(e)})]`,similar:(t,e)=>`[${d}("${t}", ${e})]`,date:z,dateBefore:z.before,dateAfter:z.after,dateBetween:z.between,dayOfMonth:z.dayOfMonth,dayOfMonthAfter:z.dayOfMonthAfter,dayOfMonthBefore:z.dayOfMonthBefore,dayOfWeek:z.dayOfWeek,dayOfWeekAfter:z.dayOfWeekAfter,dayOfWeekBefore:z.dayOfWeekBefore,month:z.month,monthBefore:z.monthBefore,monthAfter:z.monthAfter,year:z.year,hour:z.hour,hourBefore:z.hourBefore,hourAfter:z.hourAfter,number:F,gt:F.gt,lt:F.lt,inRange:F.inRange,near:_.near,geopoint:_},L=decodeURIComponent;var T={parse:function(t,e){if("string"!=typeof t)throw new TypeError("argument str must be a string");var r={},n=e||{},i=t.split(/; */),s=n.decode||L;return i.forEach(function(t){var e=t.indexOf("=");if(!(e<0)){var n=t.substr(0,e).trim(),i=t.substr(++e,t.length).trim();'"'==i[0]&&(i=i.slice(1,-1)),null==r[n]&&(r[n]=function(t,e){try{return e(t)}catch(e){return t}}(i,s))}}),r}};const U="io.prismic.preview",W="io.prismic.experiment";class P{constructor(t,e,r){this.data=t,this.masterRef=t.refs.filter(t=>t.isMasterRef)[0],this.experiments=new n(t.experiments),this.bookmarks=t.bookmarks,this.httpClient=e,this.options=r,this.refs=t.refs,this.tags=t.tags,this.types=t.types}form(t){const e=this.data.forms[t];return e?new s(e,this.httpClient):null}everything(){const t=this.form("everything");if(!t)throw new Error("Missing everything form");return t}master(){return this.masterRef.ref}ref(t){const e=this.data.refs.filter(e=>e.label===t)[0];return e?e.ref:null}currentExperiment(){return this.experiments.current()}query(t,e,r=(()=>{})){const{options:n,callback:i}="function"==typeof e?{options:{},callback:e}:{options:e||{},callback:r};let s=this.everything();for(const t in n)s=s.set(t,n[t]);if(!n.ref){let t="";this.options.req?t=this.options.req.headers.cookie||"":"undefined"!=typeof window&&window.document&&(t=window.document.cookie||"");const e=T.parse(t),r=e[U],n=this.experiments.refFromCookie(e[W]);s=s.ref(r||n||this.masterRef.ref)}return t&&s.query(t),s.submit(i)}queryFirst(t,e,r){const{options:n,callback:i}="function"==typeof e?{options:{},callback:e}:{options:e||{},callback:r||(()=>{})};return n.page=1,n.pageSize=1,this.query(t,n).then(t=>{const e=t&&t.results&&t.results[0];return i(null,e),e}).catch(t=>{throw i(t),t})}getByID(t,e,r){const n=e||{};return n.lang||(n.lang="*"),this.queryFirst(M.at("document.id",t),n,r)}getByIDs(t,e,r){const n=e||{};return n.lang||(n.lang="*"),this.query(M.in("document.id",t),n,r)}getByUID(t,e,r,n){const i=r||{};return i.lang||(i.lang="*"),this.queryFirst(M.at(`my.${t}.uid`,e),i,n)}getSingle(t,e,r){const n=e||{};return this.queryFirst(M.at("document.type",t),n,r)}getBookmark(t,e,r){const n=this.data.bookmarks[t];return n?this.getByID(n,e,r):Promise.reject("Error retrieving bookmarked id")}previewSession(t,e,r,n){return this.httpClient.request(t).then(i=>i.mainDocument?this.getByID(i.mainDocument,{ref:t}).then(t=>{if(t){const r=e(t);return n&&n(null,r),r}return n&&n(null,r),r}):(n&&n(null,r),Promise.resolve(r))).catch(t=>{throw n&&n(t),t})}}class H{constructor(t){this.data={},this.data=t}id(){return this.data.id}ref(){return this.data.ref}label(){return this.data.label}}class J{constructor(t){this.data={},this.data=t,this.variations=(t.variations||[]).map(t=>new H(t))}id(){return this.data.id}googleId(){return this.data.googleId}name(){return this.data.name}}function K(t){this.size=0,this.limit=t,this._keymap={}}K.prototype.put=function(t,e){var r={key:t,value:e};if(this._keymap[t]=r,this.tail?(this.tail.newer=r,r.older=this.tail):this.head=r,this.tail=r,this.size===this.limit)return this.shift();this.size++},K.prototype.shift=function(){var t=this.head;return t&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,t.newer=t.older=void 0,delete this._keymap[t.key]),console.log("purging ",t.key),t},K.prototype.get=function(t,e){var r=this._keymap[t];if(void 0!==r)return r===this.tail?e?r:r.value:(r.newer&&(r===this.head&&(this.head=r.newer),r.newer.older=r.older),r.older&&(r.older.newer=r.newer),r.newer=void 0,r.older=this.tail,this.tail&&(this.tail.newer=r),this.tail=r,e?r:r.value)},K.prototype.find=function(t){return this._keymap[t]},K.prototype.set=function(t,e){var r,n=this.get(t,!0);return n?(r=n.value,n.value=e):(r=this.put(t,e))&&(r=r.value),r},K.prototype.remove=function(t){var e=this._keymap[t];if(e)return delete this._keymap[e.key],e.newer&&e.older?(e.older.newer=e.newer,e.newer.older=e.older):e.newer?(e.newer.older=void 0,this.head=e.newer):e.older?(e.older.newer=void 0,this.tail=e.older):this.head=this.tail=void 0,this.size--,e.value},K.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?K.prototype.keys=function(){return Object.keys(this._keymap)}:K.prototype.keys=function(){var t=[];for(var e in this._keymap)t.push(e);return t},K.prototype.forEach=function(t,e,r){var n;if(!0===e?(r=!0,e=void 0):"object"!=typeof e&&(e=this),r)for(n=this.tail;n;)t.call(e,n.key,n.value,this),n=n.older;else for(n=this.head;n;)t.call(e,n.key,n.value,this),n=n.newer},K.prototype.toString=function(){for(var t="",e=this.head;e;)t+=String(e.key)+":"+e.value,(e=e.newer)&&(t+=" < ");return t};class G{constructor(t=1e3){this.lru=function(t){return new K(t)}(t)}isExpired(t){const e=this.lru.get(t,!1);return!!e&&(0!==e.expiredIn&&e.expiredIn<Date.now())}get(t,e){const r=this.lru.get(t,!1);r&&!this.isExpired(t)?e(null,r.data):e&&e(null)}set(t,e,r,n){this.lru.remove(t),this.lru.put(t,{data:e,expiredIn:r?Date.now()+1e3*r:0}),n&&n(null)}remove(t,e){this.lru.remove(t),e&&e(null)}clear(t){this.lru.removeAll(),t&&t(null)}}var N,Q=(function(t,e){t.exports=e=self.fetch,e.default=self.fetch.bind(self),e.Headers=self.Headers,e.Request=self.Request,e.Response=self.Response}(N={exports:{}},N.exports),N.exports);Q.Headers,Q.Request,Q.Response;const V=20;let X=0;const Y=[];function Z(t){if(Y.length>0&&X<V){X++;const e=Y.shift();e&&function(t,e,r){const n={headers:{Accept:"application/json"}};e&&e.proxyAgent&&(n.agent=e.proxyAgent),Q(t,n).then(e=>~~(e.status/100!=2)?e.text().then(()=>{const r=new Error(`Unexpected status code [${e.status}] on URL ${t}`);throw r.status=e.status,r}):e.json().then(t=>{const n=e.headers.get("cache-control"),i=n?/max-age=(\d+)/.exec(n):null,s=i?parseInt(i[1],10):void 0;r(null,t,e,s)})).catch(r)}(e.url,t,(r,n,i,s)=>{X--,e.callback(r,n,i,s),Z(t)})}}class tt{constructor(t){this.options=t||{}}request(t,e){Y.push({url:t,callback:e}),Z(this.options)}}class et{constructor(t,e,r){this.requestHandler=t||new tt({proxyAgent:r}),this.cache=e||new G}request(t,e){return new Promise((r,n)=>{this.requestHandler.request(t,(t,i,s,o)=>{t?(n(t),e&&e(t,null,s,o)):i&&(r(i),e&&e(null,i,s,o))})})}cachedRequest(t,e){const r=e||{},n=e=>{const n=r.cacheKey||t;this.cache.get(n,(i,s)=>{i||s?e(i,s):this.request(t,(t,i,s,o)=>{if(t)e(t,null);else{const t=o||r.ttl;t&&this.cache.set(n,i,t,e),e(null,i)}})})};return new Promise((t,e)=>{n((r,n)=>{r&&e(r),n&&t(n)})})}}class rt{constructor(t,e){if(this.options=e||{},this.url=t,this.options.accessToken){const e=`access_token=${this.options.accessToken}`;this.url+=(t.indexOf("?")>-1?"&":"?")+e}this.apiDataTTL=this.options.apiDataTTL||5,this.httpClient=new et(this.options.requestHandler,this.options.apiCache,this.options.proxyAgent)}get(t){return this.httpClient.cachedRequest(this.url,{ttl:this.apiDataTTL}).then(e=>{const r=new P(e,this.httpClient,this.options);return t&&t(null,r),r}).catch(e=>{throw t&&t(e),e})}}class nt{constructor(t,e){this.api=new rt(t,e)}getApi(){return this.api.get()}everything(){return this.form("everything")}form(t){return new i(t,this.api)}query(t,e,r){return this.getApi().then(n=>n.query(t,e,r))}queryFirst(t,e,r){return this.getApi().then(n=>n.queryFirst(t,e,r))}getByID(t,e,r){return this.getApi().then(n=>n.getByID(t,e,r))}getByIDs(t,e,r){return this.getApi().then(n=>n.getByIDs(t,e,r))}getByUID(t,e,r,n){return this.getApi().then(i=>i.getByUID(t,e,r,n))}getSingle(t,e,r){return this.getApi().then(n=>n.getSingle(t,e,r))}getBookmark(t,e,r){return this.getApi().then(n=>n.getBookmark(t,e,r))}previewSession(t,e,r,n){return this.getApi().then(i=>i.previewSession(t,e,r,n))}static getApi(t,e){return new rt(t,e).get()}}function it(t,e){return nt.getApi(t,e)}t.experimentCookie=W,t.previewCookie=U,t.Predicates=M,t.Experiments=class{constructor(t){t&&(this.drafts=(t.drafts||[]).map(t=>new J(t)),this.running=(t.running||[]).map(t=>new J(t)))}current(){return this.running.length>0?this.running[0]:null}refFromCookie(t){if(!t||""===t.trim())return null;const e=t.trim().split(" ");if(e.length<2)return null;const r=e[0],n=parseInt(e[1],10),i=this.running.filter(t=>t.googleId()===r&&t.variations.length>n)[0];return i?i.variations[n].ref():null}},t.Api=rt,t.client=function(t,e){return new nt(t,e)},t.getApi=it,t.api=function(t,e){return it(t,e)},Object.defineProperty(t,"__esModule",{value:!0})});
