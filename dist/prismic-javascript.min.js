!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.PrismicJS={})}(this,function(t){"use strict";var e=function(){function t(t){this.data={},this.data=t}return t.prototype.id=function(){return this.data.id},t.prototype.ref=function(){return this.data.ref},t.prototype.label=function(){return this.data.label},t}(),n=function(){function t(t){this.data={},this.data=t,this.variations=(t.variations||[]).map(function(t){return new e(t)})}return t.prototype.id=function(){return this.data.id},t.prototype.googleId=function(){return this.data.googleId},t.prototype.name=function(){return this.data.name},t}(),r=function(){function t(t){t&&(this.drafts=(t.drafts||[]).map(function(t){return new n(t)}),this.running=(t.running||[]).map(function(t){return new n(t)}))}return t.prototype.current=function(){return this.running.length>0?this.running[0]:null},t.prototype.refFromCookie=function(t){if(!t||""===t.trim())return null;var e=t.trim().split(" ");if(e.length<2)return null;var n=e[0],r=parseInt(e[1],10),i=this.running.filter(function(t){return t.googleId()===n&&t.variations.length>r})[0];return i?i.variations[r].ref():null},t}(),i=function(){function t(t,e){this.id=t,this.api=e,this.fields={}}return t.prototype.set=function(t,e){return this.fields[t]=e,this},t.prototype.ref=function(t){return this.set("ref",t)},t.prototype.query=function(t){return this.set("q",t)},t.prototype.pageSize=function(t){return this.set("pageSize",t)},t.prototype.fetch=function(t){return this.set("fetch",t)},t.prototype.fetchLinks=function(t){return this.set("fetchLinks",t)},t.prototype.lang=function(t){return this.set("lang",t)},t.prototype.page=function(t){return this.set("page",t)},t.prototype.after=function(t){return this.set("after",t)},t.prototype.orderings=function(t){return this.set("orderings",t)},t.prototype.url=function(){var e=this;return this.api.get().then(function(n){return t.toSearchForm(e,n).url()})},t.prototype.submit=function(e){var n=this;return this.api.get().then(function(r){return t.toSearchForm(n,r).submit(e)})},t.toSearchForm=function(t,e){var n=e.form(t.id);if(n)return Object.keys(t.fields).reduce(function(e,n){var r=t.fields[n];return"q"===n?e.query(r):"pageSize"===n?e.pageSize(r):"fetch"===n?e.fetch(r):"fetchLinks"===n?e.fetchLinks(r):"lang"===n?e.lang(r):"page"===n?e.page(r):"after"===n?e.after(r):"orderings"===n?e.orderings(r):e.set(n,r)},n);throw new Error("Unable to access to form "+t.id)},t}(),o=function(){function t(t,e){for(var n in this.httpClient=e,this.form=t,this.data={},t.fields)t.fields[n].default&&(this.data[n]=[t.fields[n].default])}return t.prototype.set=function(t,e){var n=this.form.fields[t];if(!n)throw new Error("Unknown field "+t);var r=""===e||void 0===e?null:e,i=this.data[t]||[];return i=n.multiple?r?i.concat([r]):i:r?[r]:i,this.data[t]=i,this},t.prototype.ref=function(t){return this.set("ref",t)},t.prototype.query=function(t){if("string"==typeof t)return this.query([t]);if(t instanceof Array)return this.set("q","["+t.join("")+"]");throw new Error("Invalid query : "+t)},t.prototype.pageSize=function(t){return this.set("pageSize",t)},t.prototype.fetch=function(t){var e=t instanceof Array?t.join(","):t;return this.set("fetch",e)},t.prototype.fetchLinks=function(t){var e=t instanceof Array?t.join(","):t;return this.set("fetchLinks",e)},t.prototype.lang=function(t){return this.set("lang",t)},t.prototype.page=function(t){return this.set("page",t)},t.prototype.after=function(t){return this.set("after",t)},t.prototype.orderings=function(t){return t?this.set("orderings","["+t.join(",")+"]"):this},t.prototype.url=function(){var t=this.form.action;if(this.data){var e=t.indexOf("?")>-1?"&":"?";for(var n in this.data)if(this.data.hasOwnProperty(n)){var r=this.data[n];if(r)for(var i=0;i<r.length;i++)t+=e+n+"="+encodeURIComponent(r[i]),e="&"}}return t},t.prototype.submit=function(t){return this.httpClient.cachedRequest(this.url()).then(function(e){return t&&t(null,e),e}).catch(function(e){throw t&&t(e),e})},t}(),u="at",s="not",a="missing",f="has",h="any",p="in",c="fulltext",l="similar",d="number.gt",y="number.lt",g="number.inRange",m="date.before",v="date.after",w="date.between",k="date.day-of-month",b="date.day-of-month-after",A="date.day-of-month-before",q="date.day-of-week",x="date.day-of-week-after",B="date.day-of-week-before",O="date.month",I="date.month-before",S="date.month-after",R="date.year",D="date.hour",C="date.hour-before",j="date.hour-after",E="geopoint.near";function _(t){if("string"==typeof t)return'"'+t+'"';if("number"==typeof t)return t.toString();if(t instanceof Date)return t.getTime().toString();if(t instanceof Array)return"["+t.map(function(t){return _(t)}).join(",")+"]";throw new Error("Unable to encode "+t+" of type "+typeof t)}var z={near:function(t,e,n,r){return"["+E+"("+t+", "+e+", "+n+", "+r+")]"}},M={before:function(t,e){return"["+m+"("+t+", "+_(e)+")]"},after:function(t,e){return"["+v+"("+t+", "+_(e)+")]"},between:function(t,e,n){return"["+w+"("+t+", "+_(e)+", "+_(n)+")]"},dayOfMonth:function(t,e){return"["+k+"("+t+", "+e+")]"},dayOfMonthAfter:function(t,e){return"["+b+"("+t+", "+e+")]"},dayOfMonthBefore:function(t,e){return"["+A+"("+t+", "+e+")]"},dayOfWeek:function(t,e){return"["+q+"("+t+", "+_(e)+")]"},dayOfWeekAfter:function(t,e){return"["+x+"("+t+", "+_(e)+")]"},dayOfWeekBefore:function(t,e){return"["+B+"("+t+", "+_(e)+")]"},month:function(t,e){return"["+O+"("+t+", "+_(e)+")]"},monthBefore:function(t,e){return"["+I+"("+t+", "+_(e)+")]"},monthAfter:function(t,e){return"["+S+"("+t+", "+_(e)+")]"},year:function(t,e){return"["+R+"("+t+", "+e+")]"},hour:function(t,e){return"["+D+"("+t+", "+e+")]"},hourBefore:function(t,e){return"["+C+"("+t+", "+e+")]"},hourAfter:function(t,e){return"["+j+"("+t+", "+e+")]"}},F={gt:function(t,e){return"["+d+"("+t+", "+e+")]"},lt:function(t,e){return"["+y+"("+t+", "+e+")]"},inRange:function(t,e,n){return"["+g+"("+t+", "+e+", "+n+")]"}},L={at:function(t,e){return"["+u+"("+t+", "+_(e)+")]"},not:function(t,e){return"["+s+"("+t+", "+_(e)+")]"},missing:function(t){return"["+a+"("+t+")]"},has:function(t){return"["+f+"("+t+")]"},any:function(t,e){return"["+h+"("+t+", "+_(e)+")]"},in:function(t,e){return"["+p+"("+t+", "+_(e)+")]"},fulltext:function(t,e){return"["+c+"("+t+", "+_(e)+")]"},similar:function(t,e){return"["+l+'("'+t+'", '+e+")]"},date:M,dateBefore:M.before,dateAfter:M.after,dateBetween:M.between,dayOfMonth:M.dayOfMonth,dayOfMonthAfter:M.dayOfMonthAfter,dayOfMonthBefore:M.dayOfMonthBefore,dayOfWeek:M.dayOfWeek,dayOfWeekAfter:M.dayOfWeekAfter,dayOfWeekBefore:M.dayOfWeekBefore,month:M.month,monthBefore:M.monthBefore,monthAfter:M.monthAfter,year:M.year,hour:M.hour,hourBefore:M.hourBefore,hourAfter:M.hourAfter,number:F,gt:F.gt,lt:F.lt,inRange:F.inRange,near:z.near,geopoint:z},T=decodeURIComponent;var U={parse:function(t,e){if("string"!=typeof t)throw new TypeError("argument str must be a string");var n={},r=e||{},i=t.split(/; */),o=r.decode||T;return i.forEach(function(t){var e=t.indexOf("=");if(!(e<0)){var r=t.substr(0,e).trim(),i=t.substr(++e,t.length).trim();'"'==i[0]&&(i=i.slice(1,-1)),null==n[r]&&(n[r]=function(t,e){try{return e(t)}catch(e){return t}}(i,o))}}),n}},W=function(){function t(t,e,n){this.data=t,this.masterRef=t.refs.filter(function(t){return t.isMasterRef})[0],this.experiments=new r(t.experiments),this.bookmarks=t.bookmarks,this.httpClient=e,this.options=n,this.refs=t.refs,this.tags=t.tags,this.types=t.types}return t.prototype.form=function(t){var e=this.data.forms[t];return e?new o(e,this.httpClient):null},t.prototype.everything=function(){var t=this.form("everything");if(!t)throw new Error("Missing everything form");return t},t.prototype.master=function(){return this.masterRef.ref},t.prototype.ref=function(t){var e=this.data.refs.filter(function(e){return e.label===t})[0];return e?e.ref:null},t.prototype.currentExperiment=function(){return this.experiments.current()},t.prototype.query=function(t,e,n){void 0===n&&(n=function(){});var r="function"==typeof e?{options:{},callback:e}:{options:e||{},callback:n},i=r.options,o=r.callback,u=this.everything();for(var s in i)u=u.set(s,i[s]);if(!i.ref){var a="";this.options.req?a=this.options.req.headers.cookie||"":"undefined"!=typeof window&&window.document&&(a=window.document.cookie||"");var f=U.parse(a),h=f["io.prismic.preview"],p=this.experiments.refFromCookie(f["io.prismic.experiment"]);u=u.ref(h||p||this.masterRef.ref)}return t&&u.query(t),u.submit(o)},t.prototype.queryFirst=function(t,e,n){var r="function"==typeof e?{options:{},callback:e}:{options:e||{},callback:n||function(){}},i=r.options,o=r.callback;return i.page=1,i.pageSize=1,this.query(t,i).then(function(t){var e=t&&t.results&&t.results[0];return o(null,e),e}).catch(function(t){throw o(t),t})},t.prototype.getByID=function(t,e,n){var r=e||{};return r.lang||(r.lang="*"),this.queryFirst(L.at("document.id",t),r,n)},t.prototype.getByIDs=function(t,e,n){var r=e||{};return r.lang||(r.lang="*"),this.query(L.in("document.id",t),r,n)},t.prototype.getByUID=function(t,e,n,r){var i=n||{};return i.lang||(i.lang="*"),this.queryFirst(L.at("my."+t+".uid",e),i,r)},t.prototype.getSingle=function(t,e,n){var r=e||{};return this.queryFirst(L.at("document.type",t),r,n)},t.prototype.getBookmark=function(t,e,n){var r=this.data.bookmarks[t];return r?this.getByID(r,e,n):Promise.reject("Error retrieving bookmarked id")},t.prototype.previewSession=function(t,e,n,r){var i=this;return this.httpClient.request(t).then(function(o){return o.mainDocument?i.getByID(o.mainDocument,{ref:t}).then(function(t){if(t){var i=e(t);return r&&r(null,i),i}return r&&r(null,n),n}):(r&&r(null,n),Promise.resolve(n))}).catch(function(t){throw r&&r(t),t})},t}();function P(t){this.size=0,this.limit=t,this._keymap={}}P.prototype.put=function(t,e){var n={key:t,value:e};if(this._keymap[t]=n,this.tail?(this.tail.newer=n,n.older=this.tail):this.head=n,this.tail=n,this.size===this.limit)return this.shift();this.size++},P.prototype.shift=function(){var t=this.head;return t&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,t.newer=t.older=void 0,delete this._keymap[t.key]),console.log("purging ",t.key),t},P.prototype.get=function(t,e){var n=this._keymap[t];if(void 0!==n)return n===this.tail?e?n:n.value:(n.newer&&(n===this.head&&(this.head=n.newer),n.newer.older=n.older),n.older&&(n.older.newer=n.newer),n.newer=void 0,n.older=this.tail,this.tail&&(this.tail.newer=n),this.tail=n,e?n:n.value)},P.prototype.find=function(t){return this._keymap[t]},P.prototype.set=function(t,e){var n,r=this.get(t,!0);return r?(n=r.value,r.value=e):(n=this.put(t,e))&&(n=n.value),n},P.prototype.remove=function(t){var e=this._keymap[t];if(e)return delete this._keymap[e.key],e.newer&&e.older?(e.older.newer=e.newer,e.newer.older=e.older):e.newer?(e.newer.older=void 0,this.head=e.newer):e.older?(e.older.newer=void 0,this.tail=e.older):this.head=this.tail=void 0,this.size--,e.value},P.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?P.prototype.keys=function(){return Object.keys(this._keymap)}:P.prototype.keys=function(){var t=[];for(var e in this._keymap)t.push(e);return t},P.prototype.forEach=function(t,e,n){var r;if(!0===e?(n=!0,e=void 0):"object"!=typeof e&&(e=this),n)for(r=this.tail;r;)t.call(e,r.key,r.value,this),r=r.older;else for(r=this.head;r;)t.call(e,r.key,r.value,this),r=r.newer},P.prototype.toString=function(){for(var t="",e=this.head;e;)t+=String(e.key)+":"+e.value,(e=e.newer)&&(t+=" < ");return t};var H=function(){function t(t){void 0===t&&(t=1e3),this.lru=function(t){return new P(t)}(t)}return t.prototype.isExpired=function(t){var e=this.lru.get(t,!1);return!!e&&(0!==e.expiredIn&&e.expiredIn<Date.now())},t.prototype.get=function(t,e){var n=this.lru.get(t,!1);n&&!this.isExpired(t)?e(null,n.data):e&&e(null)},t.prototype.set=function(t,e,n,r){this.lru.remove(t),this.lru.put(t,{data:e,expiredIn:n?Date.now()+1e3*n:0}),r&&r(null)},t.prototype.remove=function(t,e){this.lru.remove(t),e&&e(null)},t.prototype.clear=function(t){this.lru.removeAll(),t&&t(null)},t}();var J,K=(function(t,e){t.exports=e=self.fetch,e.default=self.fetch.bind(self),e.Headers=self.Headers,e.Request=self.Request,e.Response=self.Response}(J={exports:{}},J.exports),J.exports),G=(K.Headers,K.Request,K.Response,20),N=0,Q=[];function V(t){if(Q.length>0&&N<G){N++;var e=Q.shift();e&&function(t,e,n){var r={headers:{Accept:"application/json"}};e&&e.proxyAgent&&(r.agent=e.proxyAgent),K(t,r).then(function(e){return~~(e.status/100!=2)?e.text().then(function(){var n=new Error("Unexpected status code ["+e.status+"] on URL "+t);throw n.status=e.status,n}):e.json().then(function(t){var r=e.headers.get("cache-control"),i=r?/max-age=(\d+)/.exec(r):null,o=i?parseInt(i[1],10):void 0;n(null,t,e,o)})}).catch(n)}(e.url,t,function(n,r,i,o){N--,e.callback(n,r,i,o),V(t)})}}var X=function(){function t(t){this.options=t||{}}return t.prototype.request=function(t,e){Q.push({url:t,callback:e}),V(this.options)},t}(),Y=function(){function t(t,e,n){this.requestHandler=t||new X({proxyAgent:n}),this.cache=e||new H}return t.prototype.request=function(t,e){var n=this;return new Promise(function(r,i){n.requestHandler.request(t,function(t,n,o,u){t?(i(t),e&&e(t,null,o,u)):n&&(r(n),e&&e(null,n,o,u))})})},t.prototype.cachedRequest=function(t,e){var n=this,r=e||{};return new Promise(function(e,i){var o,u;o=function(t,n){t&&i(t),n&&e(n)},u=r.cacheKey||t,n.cache.get(u,function(e,i){e||i?o(e,i):n.request(t,function(t,e,i,s){if(t)o(t,null);else{var a=s||r.ttl;a&&n.cache.set(u,e,a,o),o(null,e)}})})})},t}(),Z=function(){function t(t,e){if(this.options=e||{},this.url=t,this.options.accessToken){var n="access_token="+this.options.accessToken;this.url+=(t.indexOf("?")>-1?"&":"?")+n}this.apiDataTTL=this.options.apiDataTTL||5,this.httpClient=new Y(this.options.requestHandler,this.options.apiCache,this.options.proxyAgent)}return t.prototype.get=function(t){var e=this;return this.httpClient.cachedRequest(this.url,{ttl:this.apiDataTTL}).then(function(n){var r=new W(n,e.httpClient,e.options);return t&&t(null,r),r}).catch(function(e){throw t&&t(e),e})},t}(),$=function(){function t(t,e){this.api=new Z(t,e)}return t.prototype.getApi=function(){return this.api.get()},t.prototype.everything=function(){return this.form("everything")},t.prototype.form=function(t){return new i(t,this.api)},t.prototype.query=function(t,e,n){return this.getApi().then(function(r){return r.query(t,e,n)})},t.prototype.queryFirst=function(t,e,n){return this.getApi().then(function(r){return r.queryFirst(t,e,n)})},t.prototype.getByID=function(t,e,n){return this.getApi().then(function(r){return r.getByID(t,e,n)})},t.prototype.getByIDs=function(t,e,n){return this.getApi().then(function(r){return r.getByIDs(t,e,n)})},t.prototype.getByUID=function(t,e,n,r){return this.getApi().then(function(i){return i.getByUID(t,e,n,r)})},t.prototype.getSingle=function(t,e,n){return this.getApi().then(function(r){return r.getSingle(t,e,n)})},t.prototype.getBookmark=function(t,e,n){return this.getApi().then(function(r){return r.getBookmark(t,e,n)})},t.prototype.previewSession=function(t,e,n,r){return this.getApi().then(function(i){return i.previewSession(t,e,n,r)})},t.getApi=function(t,e){return new Z(t,e).get()},t}();function tt(t,e){return $.getApi(t,e)}t.experimentCookie="io.prismic.experiment",t.previewCookie="io.prismic.preview",t.Predicates=L,t.Experiments=r,t.Api=Z,t.client=function(t,e){return new $(t,e)},t.getApi=tt,t.api=function(t,e){return tt(t,e)},Object.defineProperty(t,"__esModule",{value:!0})});
